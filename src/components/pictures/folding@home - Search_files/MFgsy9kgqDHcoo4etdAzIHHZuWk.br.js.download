var GetQnAWithTopic;(function(n){var t=function(){function n(n,t){var r=this,i;for(this.ignoreFetchClassName="df_ignore",this.closeModuleClassName="df_close",this.expansionElementClassName="b_expansion_wrapper",this.expansionElementSelector=".df_alsoAsk .b_module_expansion",this.expansionElementSelectorForTopic=".df_alsoAsk",this.topicElementSelector=".a_dummy.rel_tpc",this.transitionSelector="#df_moreqna_0 > div:not(.transform)",this.moreQnAContainerName="df_moreqna_0",this.topicContainerClassPattern=".df_topicqna",this.topicImageAttributionClassPattern=".df_topicattr",this.primaryQnAContainerId="relatedQnAListDisplay",this.moreQnALoaderName="df_load",this.errorContainerName=".df_paaError, .df_paaError *",this.hideElementClassName="b_hide",this.selectedTopicClassName="tpc_selected",this.fetchSpinnerIconUrl="/rqna/fetchSpinnerIcon",this.fetchErrorIconUrl="/rqna/fetchErrorIcon",this.imgContent="imgContent",this.AjaxParams={url:null,callback:null},this.CallComplete=!1,this.CallCompleteForTopic=!1,this.GetMoreQnAUrl=n,this.GetQnAForTopicUrl=t,this.MoreQnAContainer=_ge(this.moreQnAContainerName),this.MoreQnALoader=_ge(this.moreQnALoaderName),this.ErrorContainerList=_d.querySelectorAll(this.errorContainerName),this.PrimaryQnAContainer=_ge(this.primaryQnAContainerId),this.QnAList=_d.querySelectorAll(this.expansionElementSelector),this.MoreQnAList=null,this.TopicList=_d.querySelectorAll(this.topicElementSelector),this.TopicContainerList=_d.querySelectorAll(this.topicContainerClassPattern),this.TopicImageAttributionList=_d.querySelectorAll(this.topicImageAttributionClassPattern),this.QnAFetchCount=0,this.MoreQnACount=0,this.QnACount=this.QnAList.length,this.TopicCount=this.TopicList.length,this.PreviousSelectedTopicIndex="0",i=0;i<this.QnAList.length;i++)sj_be(this.QnAList[i],"click",function(n){return r.getMoreQnA(n.currentTarget)}),sj_be(this.QnAList[i],"keyup",function(n){return r.handleKeyboardEvent(n)});for(i=0;i<this.TopicList.length;i++)sj_be(this.TopicList[i],"click",function(n){return r.getQnAForTopic(n.currentTarget)}),sj_be(this.TopicList[i],"keyup",function(n){return r.handleKeyboardEventForTopic(n)});sj_be(_w,"scroll",function(){return r.delayedFetch()});sj_be(_w,"resize",function(){return r.delayedFetch()});sj_be(_w,"keydown",function(n){return r.disableScrollOnSpaceBar(n)});sj_evt.bind("onP1",function(){return r.fetchSpinnerIcon()},!0);sj_evt.bind("onP1",function(){return r.fetchErrorIcon()},!0)}return n.prototype.handleKeyboardEvent=function(n){(n.keyCode===13||n.keyCode===32)&&this.getMoreQnA(n.currentTarget)},n.prototype.handleKeyboardEventForTopic=function(n){(n.keyCode===13||n.keyCode===32)&&this.getQnAForTopic(n.currentTarget)},n.prototype.disableScrollOnSpaceBar=function(n){n.keyCode===32&&_d.activeElement.className.indexOf(this.expansionElementClassName)!==-1&&sj_pd(n)},n.prototype.getMoreQnA=function(n){var i=this,t=n.parentElement.parentElement;if(n==this.PreviousTarget&&!this.CallComplete){this.handleCloseModule(t);return}if(this.PreviousTarget=n,t.className.indexOf(this.closeModuleClassName)!==-1)sa_cl(t,this.closeModuleClassName,!1);else{this.handleCloseModule(t);return}if(t.className.indexOf(this.ignoreFetchClassName)===-1){sa_cl(this.MoreQnALoader,this.hideElementClassName,!1);var u=t.getAttribute("data-query"),f=t.getAttribute("data-IID"),r=function(n,r){return i.requestCallBack(n,r,t)};this.AjaxParams={url:this.GetMoreQnAUrl+u+"&IID="+f,callback:r};setTimeout(function(){i.isQnABottomScrolledIntoView()&&(i.CallComplete=!1,sj_ajax(i.AjaxParams.url,{callback:r}),i.AjaxParams={url:null,callback:null},i.QnAFetchCount++)},200)}},n.prototype.getQnAForTopic=function(n){var h=this,r=n,u,t,o,s;if(n!=this.PreviousTargetTopic||this.CallCompleteForTopic){this.PreviousTargetTopic=n;var f=r.getAttribute("data-query"),e=r.getAttribute("data-IID"),i=r.getAttribute("data-topicIndex");if(this.PreviousSelectedTopicIndex!=i){for(Log.Log("CI.TopicQnA","TopicClick","UserClick",!1,"TopicName",f,"TopicIndex",i,"KId",e),this.PreviousSelectedTopicIndex=i,t=0;t<this.ErrorContainerList.length;t++)sa_cl(this.ErrorContainerList[t],this.hideElementClassName,!0);for(t=0;t<this.TopicList.length;t++)t.toString()==i?sa_cl(this.TopicList[t],this.selectedTopicClassName,!0):sa_cl(this.TopicList[t],this.selectedTopicClassName,!1);for(u=0,t=0;t<this.TopicContainerList.length;t++)t.toString()==i?(sa_cl(this.TopicContainerList[t],this.hideElementClassName,!1),u+=this.TopicContainerList[t].querySelectorAll(this.expansionElementSelectorForTopic).length,t==0&&(sa_cl(this.PrimaryQnAContainer,this.hideElementClassName,!1),u+=this.PrimaryQnAContainer.childElementCount)):(sa_cl(this.TopicContainerList[t],this.hideElementClassName,!0),t==0&&sa_cl(this.PrimaryQnAContainer,this.hideElementClassName,!0));for(t=0;t<this.TopicImageAttributionList.length;t++)t.toString()==i?sa_cl(this.TopicImageAttributionList[t],this.hideElementClassName,!1):sa_cl(this.TopicImageAttributionList[t],this.hideElementClassName,!0);u==0&&(sa_cl(this.MoreQnALoader,this.hideElementClassName,!1),o=this.GetQnAForTopicUrl+f+"&IID="+e,s=function(n,t){return h.requestCallBackForTopic(n,t,r,i)},this.CallCompleteForTopic=!1,sj_ajax(o,{callback:s}))}}},n.prototype.fetchSpinnerIcon=function(){var n=this,t=function(t,i){return n.fetchSpinnerCallBack(t,i)};sj_ajax(this.fetchSpinnerIconUrl,{callback:t})},n.prototype.fetchSpinnerCallBack=function(n,t){n&&t.appendTo(this.MoreQnALoader)},n.prototype.fetchErrorIcon=function(){var n=this,t=function(t,i){return n.fetchErrorCallBack(t,i)};sj_ajax(this.fetchErrorIconUrl,{callback:t})},n.prototype.fetchErrorCallBack=function(n,t){if(n)for(var i=0;i<this.ErrorContainerList.length;i++)t.appendTo(this.ErrorContainerList[i])},n.prototype.requestCallBack=function(n,t,i){var u=this,r;if(n){t.appendTo(this.MoreQnAContainer);this.animateDivs();this.MoreQnAList=this.MoreQnAContainer.querySelectorAll(this.expansionElementSelector);var f="",o=function(n){sj_be(e.MoreQnAList[n],"click",function(){return u.getMoreQnA(u.MoreQnAList[n])});sj_be(e.MoreQnAList[n],"keyup",function(n){return u.handleKeyboardEvent(n)});f==""&&(f=e.MoreQnAList[n].parentElement.parentElement.getAttribute("data-ParentIID"),i.setAttribute("data-IID",f))},e=this;for(r=this.MoreQnACount;r<this.MoreQnAList.length;r++)o(r);this.MoreQnACount=this.MoreQnAList.length;typeof rms!="undefined"&&rms.start()}else sa_cl(i,this.ignoreFetchClassName,!0),Log.Log("CI.MoreQnA","MoreQnAFetch","FetchFailed",!1,"Url",this.GetMoreQnAUrl),this.hideLoader();this.QnAFetchCount--;this.CallComplete=!0;this.hideLoader()},n.prototype.requestCallBackForTopic=function(n,t,i,r){var f=this,u;if(n)t.appendTo(this.TopicContainerList[r]),setTimeout(function(){for(var t=f.TopicContainerList[r].querySelectorAll(f.expansionElementSelectorForTopic),n=0;n<t.length;n++)sa_cl(t[n],"transform",!0)},100),typeof rms!="undefined"&&rms.start();else{for(u=0;u<this.ErrorContainerList.length;u++)u.toString()==r&&this.PreviousSelectedTopicIndex==r?sa_cl(this.ErrorContainerList[u],this.hideElementClassName,!1):sa_cl(this.ErrorContainerList[u],this.hideElementClassName,!0);Log.Log("CI.TopicQnA","TopicQnAFetch","FetchFailed",!1,"Url",this.GetMoreQnAUrl);this.hideLoaderForTopics()}this.CallCompleteForTopic=!0;this.hideLoaderForTopics()},n.prototype.isQnABottomScrolledIntoView=function(){var n=this.MoreQnAContainer.getBoundingClientRect();return n.bottom<=_w.innerHeight},n.prototype.hideLoader=function(){this.QnAFetchCount==0&&sa_cl(this.MoreQnALoader,this.hideElementClassName,!0)},n.prototype.hideLoaderForTopics=function(){sa_cl(this.MoreQnALoader,this.hideElementClassName,!0)},n.prototype.delayedFetch=function(){this.AjaxParams.url!=null&&this.AjaxParams.callback!=null&&this.isQnABottomScrolledIntoView()&&(sj_ajax(this.AjaxParams.url,{callback:this.AjaxParams.callback}),this.AjaxParams={url:null,callback:null},this.QnAFetchCount++)},n.prototype.animateDivs=function(){var n=this;setTimeout(function(){for(var i=_d.querySelectorAll(n.transitionSelector),t=0;t<i.length;t++)sa_cl(i[t],"transform",!0)},100)},n.prototype.handleCloseModule=function(n){var i=this,t;sa_cl(n,this.closeModuleClassName,!0);t=n.getElementsByClassName("df_imgCont")[0];t&&t.getAttribute(this.imgContent)!=null&&(t.innerHTML=t.getAttribute(this.imgContent),t.removeAttribute(this.imgContent));setTimeout(function(){return i.delayedFetch()},500)},n}();n.QnAFetcher=t;sj_evt.fire("OnGetQnAWithTopicInitComplete")})(GetQnAWithTopic||(GetQnAWithTopic={}))